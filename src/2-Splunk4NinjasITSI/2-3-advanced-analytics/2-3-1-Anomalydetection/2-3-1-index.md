# 2-3-1. Anomaly Detection 설정 하기

**ITSI Anomaly Detection**은 고정 임계값(Threshold)에 의존하지 않고, **과거 패턴을 학습해 “평소와 다른” 이상 징후**를 자동으로 감지하는 기능입니다.  
트래픽의 시계열 특성(시간대/요일/계절성)을 고려한 **동적 기준선(Baseline)**을 만들고, 실측 KPI가 기대 범위를 벗어날 때 이상으로 표시합니다.  
이를 통해 알려지지 않은 유형(Unknown Unknowns)의 문제를 조기에 발견할 수 있습니다.

## 언제 쓰나?

- 업무 시간/야간 등 **시간대별 정상 범위가 크게 변하는 KPI**(응답시간, 트랜잭션 수, 에러율 등)
- 고정 Threshold로는 놓치기 쉬운 **비선형 변화·드리프트** 감지

## ITSI Anomaly Detection 알고리즘 비교

| 구분            | 트렌딩 알고리즘 (Trending)                                       | 엔티티 응집도 알고리즘 (Entity Cohesion)                       |
| --------------- | ---------------------------------------------------------------- | -------------------------------------------------------------- |
| **분석 관점**   | 한 엔티티의 **시간적 변화(과거 대비 현재)** 감지                 | 여러 엔티티 간의 **상대적 차이(피어 비교)** 감지               |
| **기준**        | 과거 데이터로 만든 **동적 기준선(Baseline)**                     | 동시간대 엔티티 집합의 **중앙값/분포(코호트 기준)**            |
| **강점**        | - 계절성·추세 반영 가능<br>- 드리프트/비정상 패턴 감지           | - Outlier(특이 엔티티) 식별<br>- 다수 엔티티 동시 이상 탐지    |
| **적합한 지표** | 응답시간, 에러율, 트래픽 등 **시계열 변동성 큰 KPI**             | 다수 인스턴스/호스트 기반 서비스의 **상대 비교 KPI**           |
| **적합한 상황** | - 서비스 전체 패턴 변화 조기 탐지<br>- 임계값 세팅이 어려운 지표 | - 특정 엔티티만 튀는 경우<br>- 다수 엔티티 동시 장애 범위 확인 |
| **한계**        | 초기 학습 필요, 데이터 부족 시 정확도 저하                       | 엔티티 수가 적거나 동질적이지 않으면 효과 낮음                 |
| **비유**        | "이 엔티티가 평소보다 이상해졌나?"                               | "여러 엔티티 중 누가 다르게 움직이나?"                         |

## Threshold와의 차이 / 함께 쓰는 방법

- **Threshold**: 단순·명확(규정 위반 즉시 알람), 계절성/드리프트에 취약
- **Anomaly Detection**: **동적 기준선**으로 변화에 탄력적, 미지 패턴 탐지에 강함
- 베스트 프랙티스:
  - 안정된 SLO/SLA는 **Threshold**로,
  - 변동성이 큰 지표·초기 탐색은 **Anomaly Detection**으로,
  - 필요 시 **Multi-KPI Alert**로 맥락 결합

## 결과 활용 시나리오(Incident Flow)

1. **Anomaly Notable 생성**
2. **Aggregation Policy**로 관련 이벤트 Episode 집계(서비스/엔티티/ID 기준)
3. Episode 룰로 **Severity/Status** 자동 전환(또는 `state=clear` 신호로 종료)
4. 대시보드/Glass Table에서 **헬스 점수 & MTL 컨텍스트**로 트리아지

## 장애물·문제 해결

- **결과가 너무 많다**: 민감도 낮춤, Multi-KPI와 결합
- **초기 품질 낮음**: Cold start 기간 확보(며칠~수주), 기준선 안정 후 재튜닝

## 요약

Anomaly Detection은 **동적 기준선 + 지속성 + 방향성**으로 이상 징후를 자동 탐지하여,  
고정 임계값의 한계를 보완합니다. Event Analytics의 Thresholds/Alerts/Policies와 결합하면  
**노이즈는 낮추고, 발견 속도와 정확도는 높이는** 운영 체계를 만들 수 있습니다.

## Lab 10. Anomaly Detection 설정하기
